name: Test and Coverage

on:
 push:
   branches:
     - main
 pull_request:
   types: [opened, synchronize, reopened]

jobs:
  test-and-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3

    - name: Install dependencies
      run: yarn

    - name: Run tests and coverage
      run: yarn jest --coverage
      env:
        CI: true

    - name: Upload coverage report
      id: kover
      uses: mi-kas/kover-report@v1
      with:
          path: ${{ github.workspace }}coverage/clover.xml
          token: ${{ secrets.GITHUB_TOKEN }}
          title: Code Coverage
          update-comment: true
          min-coverage-overall: 10
          min-coverage-changed-files: 80
          coverage-counter-type: LINE




